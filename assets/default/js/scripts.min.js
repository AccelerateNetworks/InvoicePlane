"use strict";function insert_at_caret(e,t){var a=document.getElementById(e),i=a.scrollTop,l=0,n=a.selectionStart||"0"===a.selectionStart?"ff":document.selection?"ie":!1,r;"ie"===n?(a.focus(),r=document.selection.createRange(),r.moveStart("character",-a.value.length),l=r.text.length):"ff"===n&&(l=a.selectionStart);var c=a.value.substring(0,l),o=a.value.substring(l,a.value.length);a.value=c+t+o,l+=t.length,"ie"===n?(a.focus(),r=document.selection.createRange(),r.moveStart("character",-a.value.length),r.moveStart("character",l),r.moveEnd("character",0),r.select()):"ff"===n&&(a.selectionStart=l,a.selectionEnd=l,a.focus()),a.scrollTop=i}function inject_email_template(e,t){$.each(t,function(t,a){t=t.replace("email_template_",""),a&&e.indexOf(t)>-1&&("body"===t?$("#"+t).html(a):$("#"+t).val(a))})}function update_email_template_preview(){$("#email-template-preview").contents().find("body").html($(".email-template-body").val())}function insert_html_tag(e,t){var a,i,l,n,r,c,o,d,m;switch(e){case"text-bold":a=["<b>","</b>"];break;case"text-italic":a=["<em>","</em>"];break;case"text-paragraph":a=["<p>","</p>"];break;case"text-h1":a=["<h1>","</h1>"];break;case"text-h2":a=["<h2>","</h2>"];break;case"text-h3":a=["<h3>","</h3>"];break;case"text-h4":a=["<h4>","</h4>"];break;case"text-code":a=["<code>","</code>"];break;case"text-hr":a=["<hr/>",""];break;case"text-css":a=["<style></style>",""]}return l=document.getElementById(t),void 0!==document.selection?(l.focus(),i=document.selection.createRange(),n=i.text):""!==l.selectionStart&&(r=l.selectionStart,c=l.selectionEnd,n=l.value.substring(r,c)),"text-css"===e?(o=a[0]+"\n\r"+l.value,$(l).val(o),update_email_template_preview(),!0):0===a[1].length?(insert_at_caret(t,a[0]),update_email_template_preview(),!0):void(n&&n.length?(d=a[0]+n+a[1],m=l.value.length,o=l.value.substring(0,r)+d+l.value.substring(c,m),$(l).val(o),update_email_template_preview()):(a=a[0]+a[1],insert_at_caret(t,a),update_email_template_preview()))}function get_next_item_id(){var e=$("#item_table");return e?e.find(".item").length:void 0}function add_new_item_row(){var e=get_next_item_id(),t=$("#blank-row").clone().appendTo("#item_table").removeAttr("id").addClass("item").show();return t.find(".form-control").each(function(){var t=$(this);t.attr("name",t.attr("name").replace("items[]","items["+e+"]")),t.attr("disabled",null)}),t}$(document).ready(function(){var e=$("html").outerHeight(),t=$(".navbar").outerHeight(),a=$("#headerbar").outerHeight(),i=e-t-a;$("#content").outerHeight()<i&&$("#content").outerHeight(i),$("html").click(function(){$(".dropdown-menu:visible").not(".datepicker").removeAttr("style")}),$('[data-toggle="tooltip"]').tooltip();var l;$(".text-tag").bind("click",function(){var e=this.getAttribute("data-tag");return insert_at_caret(l.id,e),!1}),$(".taggable").on("focus",function(){l=this}),$(".html-tag").click(function(){var e=$(this).data("tagType"),t=$(".email-template-body").attr("id");insert_html_tag(e,t)});var n=$(".email-template-body").attr("id");$("#email_template_preview").empty()&&update_email_template_preview(),$(n).bind("input propertychange",function(){update_email_template_preview()}),$("#email-template-preview-reload").click(function(){update_email_template_preview()}),$(".ajax-loader").bind("click",function(){$("#fullpage-loader").fadeIn(200),$("#loader-error").delay(1e4).fadeIn(200)}),$(".load-modal-by-url").click(function(){$("#modal-placeholder").load($(this).data("modal-url"))}),$(".btn-add-new-row").click(function(){add_new_item_row()})});